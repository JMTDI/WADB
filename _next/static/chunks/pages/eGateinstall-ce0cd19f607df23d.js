(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{3601:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/eGateinstall",function(){return a(5983)}])},5983:function(e,t,a){"use strict";a.r(t);var s,n,i=a(541);a(8425);var o=a(4185),l=a(3007),r=a(5129),c=a(6694),d=a(9003),g=a(1194),h=a(6643),p=a(1768),m=a.n(p),u=a(5654),f=a(2274);(s=n||(n={}))[s.Downloading=0]="Downloading",s[s.Installing=1]="Installing",s[s.SettingPermissions=2]="SettingPermissions",s[s.Completed=3]="Completed";let w={general:"https://github.com/offlinesoftwaresolutions/eGate/releases/latest/download/app-general-release.apk","lg-classic":"https://github.com/offlinesoftwaresolutions/eGate/releases/latest/download/app-lgclassic-release.apk",external:"https://github.com/offlinesoftwaresolutions/eGate/releases/latest/download/app-external_accessibility-release.apk"},y={general:"app-general-release.apk","lg-classic":"app-lgclassic-release.apk",external:"app-external_accessibility-release.apk"},b={general:"com.oss.egate","lg-classic":"com.android.cts.egate",external:"com.oss.accessibility"},z=new class{constructor(){this.installing=!1,this.progress=void 0,this.log="",this.options={},this.runCommand=async e=>{if(!u.GLOBAL_STATE.adb||!u.GLOBAL_STATE.adb.subprocess||"function"!=typeof u.GLOBAL_STATE.adb.subprocess.shell)throw Error("ADB subprocess.shell not available.");try{let t=await u.GLOBAL_STATE.adb.subprocess.shell(e),a=new TextDecoder,s="",n=t.stdout.getReader();try{for(;;){let{done:e,value:t}=await n.read();if(e)break;s+=a.decode(t,{stream:!0})}}finally{n.releaseLock()}if(t.stderr){let e=t.stderr.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)break;s+=a.decode(n,{stream:!0})}}finally{e.releaseLock()}}return s.trim()}catch(e){throw Error("Command execution failed: ".concat(e.message))}},this.install=async e=>{let t;let a=w[e];try{(0,g.z)(()=>{this.progress={filename:y[e],stage:n.Downloading,value:0},this.log='Downloading "'.concat(e,'" variant...\n'),this.installing=!0});let i=[async()=>{(0,g.z)(()=>{this.log+="Trying direct download...\n"});let e=await fetch(a,{mode:"cors"});if(!e.ok)throw Error("Direct: ".concat(e.status));return e},async()=>{for(let e of["https://corsproxy.io/?","https://cors.sh/","https://api.allorigins.win/raw?url=","https://cors-anywhere.herokuapp.com/","https://thingproxy.freeboard.io/fetch/"])try{(0,g.z)(()=>{this.log+="Trying proxy: ".concat(e,"\n")});let t=e+encodeURIComponent(a),s=await fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"application/vnd.android.package-archive,application/octet-stream,*/*"}});if(s.ok)return(0,g.z)(()=>{this.log+="Proxy successful: ".concat(e,"\n")}),s}catch(t){(0,g.z)(()=>{this.log+="Proxy failed: ".concat(e," - ").concat(t.message,"\n")})}throw Error("All proxies failed")},async()=>{(0,g.z)(()=>{this.log+="Trying jsdelivr CDN...\n"});let e=a.replace("https://github.com/offlinesoftwaresolutions/eGate/releases/latest/download/","https://cdn.jsdelivr.net/gh/offlinesoftwaresolutions/eGate@latest/"),t=await fetch(e);if(!t.ok)throw Error("CDN: ".concat(t.status));return t},async()=>{throw(0,g.z)(()=>{this.log+="All automated methods failed. Please:\n",this.log+="1. Open: ".concat(a,"\n"),this.log+="2. Save the APK file\n",this.log+="3. Use the file upload feature (if available)\n"}),Error("Manual download required")}],o=null,l=null;for(let e of i)try{if((o=await e())&&o.ok)break}catch(e){l=e}if(!o||!o.ok){var s;throw Error("All download methods failed. Last error: ".concat(null===(s=l)||void 0===s?void 0:s.message))}if(t=await o.blob(),0===t.size)throw Error("Downloaded file is empty");let r=o.headers.get("content-type");r&&!r.includes("application/vnd.android.package-archive")&&!r.includes("application/octet-stream")&&t.size<1e6&&(0,g.z)(()=>{this.log+="Warning: Downloaded file may not be an APK (".concat(r,", ").concat(t.size," bytes)\n")})}catch(t){(0,g.z)(()=>{this.log+='Download error for variant "'.concat(e,'": ').concat(t.message,"\n"),this.installing=!1});return}let i=y[e],o=new File([t],i,{type:t.type,lastModified:Date.now()});if((0,g.z)(()=>{this.progress={filename:o.name,stage:n.Installing,value:.1},this.log+="APK downloaded: ".concat(o.name,"\n")}),!u.GLOBAL_STATE.adb){(0,g.z)(()=>{this.log+="ADB connection not established via GLOBAL_STATE.adb.\n",this.installing=!1});return}let l=new c.LE(u.GLOBAL_STATE.adb),r=Date.now();try{let e=await l.installStream(o.size,(0,f.Xd)(o).pipeThrough(new d.WrapConsumableStream).pipeThrough(new f.hK((0,g.aD)(e=>{let t=e/o.size;this.progress={filename:o.name,stage:e<o.size?n.Installing:n.SettingPermissions,value:e<o.size?t:.8}}))),{...this.options,grantRuntimePermissions:!0});(0,g.z)(()=>{this.log+="Installation output: ".concat(e,"\n")})}catch(e){(0,g.z)(()=>{this.log+="Error during APK install: ".concat(e.message,"\n"),this.installing=!1});return}let h=b[e];try{if((0,g.z)(()=>{this.log+="Setting up package: ".concat(h,"\n"),this.progress={filename:o.name,stage:n.SettingPermissions,value:.9}}),"lg-classic"===e){try{let e=await this.runCommand("pm uninstall -k --user 0 com.qualcomm.simcontacts");(0,g.z)(()=>{this.log+="Uninstall simcontacts output: ".concat(e||"Command completed","\n")})}catch(e){(0,g.z)(()=>{this.log+="Uninstall simcontacts failed: ".concat(e.message,"\n")})}try{let e=await this.runCommand("dpm set-device-owner com.android.cts.egate/.a");(0,g.z)(()=>{this.log+="Device owner set (lg-classic): ".concat(e||"Command completed","\n")})}catch(e){(0,g.z)(()=>{this.log+="Device owner setup failed: ".concat(e.message,"\n")})}}else if("general"===e)try{let e=await this.runCommand("dpm set-device-owner ".concat(h,"/.a"));(0,g.z)(()=>{this.log+="Device owner set: ".concat(e||"Command completed","\n")})}catch(e){(0,g.z)(()=>{this.log+="Device owner setup failed: ".concat(e.message,"\n")})}else"external"===e&&(0,g.z)(()=>{this.log+="Skipping device owner setup for external accessibility variant.\n"});(0,g.z)(()=>{this.progress={filename:o.name,stage:n.Completed,value:1}})}catch(e){(0,g.z)(()=>{this.log+="Error during package setup: ".concat(e.message,"\n"),this.progress={filename:o.name,stage:n.Completed,value:1}})}let p=Date.now()-r,m=(o.size/(p/1e3)/1024/1024).toFixed(2);(0,g.z)(()=>{this.log+="\nInstall process completed in ".concat(p," ms at ").concat(m," MB/s\n"),this.installing=!1})},(0,g.ky)(this,{progress:g.LO.ref})}};t.default=(0,h.Pi)(()=>{let e=!!u.GLOBAL_STATE.adb,t=!e||z.installing;return(0,i.jsxs)(o.K,{...f.LE,tokens:{childrenGap:20},children:[(0,i.jsx)(m(),{children:(0,i.jsx)("title",{children:"eGate auto-installer - WADB"})}),(0,i.jsxs)(o.K,{horizontal:!0,tokens:{childrenGap:15},children:[(0,i.jsx)(l.K,{disabled:t,text:"General",onClick:()=>z.install("general")}),(0,i.jsx)(l.K,{disabled:t,text:"LG Classic",onClick:()=>z.install("lg-classic")}),(0,i.jsx)(l.K,{disabled:t,text:"External Accessibility",onClick:()=>z.install("external")})]}),z.progress&&(0,i.jsx)(r.Y,{styles:{root:{width:300,marginTop:20}},label:z.progress.filename,percentComplete:z.progress.value,description:n[z.progress.stage]}),z.log&&(0,i.jsx)("pre",{style:{marginTop:20,whiteSpace:"pre-wrap",fontFamily:"monospace"},children:z.log})]})})}},function(e){e.O(0,[774,888,179],function(){return e(e.s=3601)}),_N_E=e.O()}]);
//# sourceMappingURL=eGateinstall-ce0cd19f607df23d.js.map