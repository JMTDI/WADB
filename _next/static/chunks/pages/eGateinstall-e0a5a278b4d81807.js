(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{3601:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/eGateinstall",function(){return s(5983)}])},5983:function(e,t,s){"use strict";s.r(t);var a,o,n=s(541);s(8425);var i=s(4185),l=s(3007),r=s(5129),c=s(6694),d=s(9003),h=s(1194),g=s(6643),p=s(1768),m=s.n(p),u=s(5654),f=s(2274);(a=o||(o={}))[a.Downloading=0]="Downloading",a[a.Installing=1]="Installing",a[a.SettingPermissions=2]="SettingPermissions",a[a.Completed=3]="Completed";let w={general:"app-general-release.apk","lg-classic":"app-lgclassic-release.apk",external:"app-external_accessibility-release.apk"},y={general:"https://github.com/offlinesoftwaresolutions/eGate/releases/latest/download/app-general-release.apk","lg-classic":"https://github.com/offlinesoftwaresolutions/eGate/releases/latest/download/app-lgclassic-release.apk",external:"https://github.com/offlinesoftwaresolutions/eGate/releases/latest/download/app-external_accessibility-release.apk"},x={general:"com.oss.egate","lg-classic":"com.android.cts.egate",external:"com.oss.accessibility"},b=new class{constructor(){this.installing=!1,this.progress=void 0,this.log="",this.options={},this.fetchWithCorsProxy=async e=>{var t;let s=[async e=>{let t="https://api.allorigins.win/raw?url=".concat(encodeURIComponent(e)),s=await fetch(t);if(!s.ok)throw Error("AllOrigins proxy failed: ".concat(s.status));return s},async e=>{let t=await fetch("https://cors.sh/".concat(e));if(!t.ok)throw Error("Cors.sh proxy failed: ".concat(t.status));return t},async e=>{let t="https://proxy-cors.vercel.app/api/proxy?url=".concat(encodeURIComponent(e)),s=await fetch(t);if(!s.ok)throw Error("Proxy-cors failed: ".concat(s.status));return s},async e=>{let t=await fetch(e,{method:"GET",mode:"no-cors",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});return t},async e=>{let t=await fetch(e,{method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"application/vnd.android.package-archive,*/*","Cache-Control":"no-cache"}});return t}],a=null;for(let t=0;t<s.length;t++)try{(0,h.z)(()=>{this.log+="Trying proxy method ".concat(t+1,"...\n")});let a=await s[t](e);if(a.ok||"opaque"===a.type)return(0,h.z)(()=>{this.log+="Proxy method ".concat(t+1," succeeded!\n")}),a;throw Error("Response not ok: ".concat(a.status))}catch(e){a=e,(0,h.z)(()=>{this.log+="Proxy method ".concat(t+1," failed: ").concat(e.message,"\n")});continue}throw Error("All proxy methods failed. Last error: ".concat(null===(t=a)||void 0===t?void 0:t.message))},this.runCommand=async e=>{if(!u.GLOBAL_STATE.adb||!u.GLOBAL_STATE.adb.subprocess||"function"!=typeof u.GLOBAL_STATE.adb.subprocess.shell)throw Error("ADB subprocess.shell not available.");try{let t=await u.GLOBAL_STATE.adb.subprocess.shell(e),s=new TextDecoder,a="",o=t.stdout.getReader();try{for(;;){let{done:e,value:t}=await o.read();if(e)break;a+=s.decode(t,{stream:!0})}}finally{o.releaseLock()}if(t.stderr){let e=t.stderr.getReader();try{for(;;){let{done:t,value:o}=await e.read();if(t)break;a+=s.decode(o,{stream:!0})}}finally{e.releaseLock()}}return a.trim()}catch(e){throw Error("Command execution failed: ".concat(e.message))}},this.install=async e=>{let t;let s=y[e];try{(0,h.z)(()=>{this.progress={filename:w[e],stage:o.Downloading,value:0},this.log='Starting download of "'.concat(e,'" variant from GitHub...\n'),this.log+="Target URL: ".concat(s,"\n"),this.installing=!0});let a=await this.fetchWithCorsProxy(s);if("opaque"===a.type)(0,h.z)(()=>{this.log+="Received opaque response (no-cors mode). Attempting to process...\n"}),t=await a.blob();else{if(!a.ok)throw Error("HTTP ".concat(a.status,": ").concat(a.statusText));let e=a.headers.get("content-length");e&&(0,h.z)(()=>{this.log+="Content length: ".concat((parseInt(e)/1024/1024).toFixed(2)," MB\n")}),t=await a.blob()}if(!t||0===t.size)throw Error("Downloaded file is empty or invalid");(0,h.z)(()=>{this.log+="Download completed! File size: ".concat((t.size/1024/1024).toFixed(2)," MB\n")})}catch(t){(0,h.z)(()=>{this.log+='Download error for variant "'.concat(e,'": ').concat(t.message,"\n"),this.log+="This might be due to CORS restrictions or network issues.\n",this.installing=!1});return}let a=w[e],n=new File([t],a,{type:t.type,lastModified:Date.now()});if((0,h.z)(()=>{this.progress={filename:n.name,stage:o.Installing,value:.1},this.log+="APK downloaded: ".concat(n.name,"\n")}),!u.GLOBAL_STATE.adb){(0,h.z)(()=>{this.log+="ADB connection not established via GLOBAL_STATE.adb.\n",this.installing=!1});return}let i=new c.LE(u.GLOBAL_STATE.adb),l=Date.now();try{let e=await i.installStream(n.size,(0,f.Xd)(n).pipeThrough(new d.WrapConsumableStream).pipeThrough(new f.hK((0,h.aD)(e=>{let t=e/n.size;this.progress={filename:n.name,stage:e<n.size?o.Installing:o.SettingPermissions,value:e<n.size?t:.8}}))),{...this.options,grantRuntimePermissions:!0});(0,h.z)(()=>{this.log+="Installation output: ".concat(e,"\n")})}catch(e){(0,h.z)(()=>{this.log+="Error during APK install: ".concat(e.message,"\n"),this.installing=!1});return}let r=x[e];try{if((0,h.z)(()=>{this.log+="Setting up package: ".concat(r,"\n"),this.progress={filename:n.name,stage:o.SettingPermissions,value:.9}}),"lg-classic"===e){try{let e=await this.runCommand("pm uninstall -k --user 0 com.qualcomm.simcontacts");(0,h.z)(()=>{this.log+="Uninstall simcontacts output: ".concat(e||"Command completed","\n")})}catch(e){(0,h.z)(()=>{this.log+="Uninstall simcontacts failed: ".concat(e.message,"\n")})}try{let e=await this.runCommand("dpm set-device-owner com.android.cts.egate/.a");(0,h.z)(()=>{this.log+="Device owner set (lg-classic): ".concat(e||"Command completed","\n")})}catch(e){(0,h.z)(()=>{this.log+="Device owner setup failed: ".concat(e.message,"\n")})}}else if("general"===e)try{let e=await this.runCommand("dpm set-device-owner ".concat(r,"/.a"));(0,h.z)(()=>{this.log+="Device owner set: ".concat(e||"Command completed","\n")})}catch(e){(0,h.z)(()=>{this.log+="Device owner setup failed: ".concat(e.message,"\n")})}else"external"===e&&(0,h.z)(()=>{this.log+="Skipping device owner setup for external accessibility variant.\n"});(0,h.z)(()=>{this.progress={filename:n.name,stage:o.Completed,value:1}})}catch(e){(0,h.z)(()=>{this.log+="Error during package setup: ".concat(e.message,"\n"),this.progress={filename:n.name,stage:o.Completed,value:1}})}let g=Date.now()-l,p=(n.size/(g/1e3)/1024/1024).toFixed(2);(0,h.z)(()=>{this.log+="\nInstall process completed in ".concat(g," ms at ").concat(p," MB/s\n"),this.installing=!1})},(0,h.ky)(this,{progress:h.LO.ref})}};t.default=(0,g.Pi)(()=>{let e=!!u.GLOBAL_STATE.adb,t=!e||b.installing;return(0,n.jsxs)(i.K,{...f.LE,tokens:{childrenGap:20},children:[(0,n.jsx)(m(),{children:(0,n.jsx)("title",{children:"eGate auto-installer - WADB"})}),(0,n.jsxs)(i.K,{horizontal:!0,tokens:{childrenGap:15},children:[(0,n.jsx)(l.K,{disabled:t,text:"General",onClick:()=>b.install("general")}),(0,n.jsx)(l.K,{disabled:t,text:"LG Classic",onClick:()=>b.install("lg-classic")}),(0,n.jsx)(l.K,{disabled:t,text:"External Accessibility",onClick:()=>b.install("external")})]}),b.progress&&(0,n.jsx)(r.Y,{styles:{root:{width:300,marginTop:20}},label:b.progress.filename,percentComplete:b.progress.value,description:o[b.progress.stage]}),b.log&&(0,n.jsx)("pre",{style:{marginTop:20,whiteSpace:"pre-wrap",fontFamily:"monospace"},children:b.log})]})})}},function(e){e.O(0,[774,888,179],function(){return e(e.s=3601)}),_N_E=e.O()}]);
//# sourceMappingURL=eGateinstall-e0a5a278b4d81807.js.map