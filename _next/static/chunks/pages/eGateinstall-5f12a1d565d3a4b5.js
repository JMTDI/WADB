(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{3039:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/eGateinstall",function(){return s(9308)}])},9308:function(e,t,s){"use strict";s.r(t);var a,n,i=s(9378);s(2871);var l=s(8291),o=s(4884),r=s(4547),c=s(5171),g=s(3248),d=s(9343),m=s(117),p=s(9572),h=s.n(p),u=s(5136),w=s(1636);(a=n||(n={}))[a.Downloading=0]="Downloading",a[a.Installing=1]="Installing",a[a.SettingPermissions=2]="SettingPermissions",a[a.Completed=3]="Completed";let f={general:"app-general-release.apk","lg-classic":"app-lgclassic-release.apk",external:"app-external_accessibility-release.apk"},b={general:"com.oss.egate","lg-classic":"com.android.cts.egate",external:"com.oss.accessibility"},y=new class{constructor(){this.installing=!1,this.progress=void 0,this.log="",this.options={},this.runCommand=async e=>{if(!u.GLOBAL_STATE.adb||!u.GLOBAL_STATE.adb.subprocess||"function"!=typeof u.GLOBAL_STATE.adb.subprocess.shell)throw Error("ADB subprocess.shell not available.");try{let t=await u.GLOBAL_STATE.adb.subprocess.shell(e),s=new TextDecoder,a="",n=t.stdout.getReader();try{for(;;){let{done:e,value:t}=await n.read();if(e)break;a+=s.decode(t,{stream:!0})}}finally{n.releaseLock()}if(t.stderr){let e=t.stderr.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)break;a+=s.decode(n,{stream:!0})}}finally{e.releaseLock()}}return a.trim()}catch(e){throw Error("Command execution failed: ".concat(e.message))}},this.install=async e=>{let t;let s="/proxy?variant=".concat(encodeURIComponent(e));try{(0,d.z)(()=>{this.progress={filename:f[e],stage:n.Downloading,value:0},this.log='Downloading "'.concat(e,'" variant...\n'),this.installing=!0});let a=await fetch(s,{mode:"cors"});if(!a.ok)throw Error("Failed to download APK: ".concat(a.statusText));t=await a.blob()}catch(t){(0,d.z)(()=>{this.log+='Download error for variant "'.concat(e,'": ').concat(t.message,"\n"),this.installing=!1});return}let a=f[e],i=new File([t],a,{type:t.type,lastModified:Date.now()});if((0,d.z)(()=>{this.progress={filename:i.name,stage:n.Installing,value:.1},this.log+="APK downloaded: ".concat(i.name,"\n")}),!u.GLOBAL_STATE.adb){(0,d.z)(()=>{this.log+="ADB connection not established via GLOBAL_STATE.adb.\n",this.installing=!1});return}let l=new c.LE(u.GLOBAL_STATE.adb),o=Date.now();try{let e=await l.installStream(i.size,(0,w.Xd)(i).pipeThrough(new g.WrapConsumableStream).pipeThrough(new w.hK((0,d.aD)(e=>{let t=e/i.size;this.progress={filename:i.name,stage:e<i.size?n.Installing:n.SettingPermissions,value:e<i.size?t:.8}}))),{...this.options,grantRuntimePermissions:!0});(0,d.z)(()=>{this.log+="Installation output: ".concat(e,"\n")})}catch(e){(0,d.z)(()=>{this.log+="Error during APK install: ".concat(e.message,"\n"),this.installing=!1});return}let r=b[e];try{if((0,d.z)(()=>{this.log+="Setting up package: ".concat(r,"\n"),this.progress={filename:i.name,stage:n.SettingPermissions,value:.9}}),"lg-classic"===e){try{let e=await this.runCommand("pm uninstall -k --user 0 com.qualcomm.simcontacts");(0,d.z)(()=>{this.log+="Uninstall simcontacts output: ".concat(e||"Command completed","\n")})}catch(e){(0,d.z)(()=>{this.log+="Uninstall simcontacts failed: ".concat(e.message,"\n")})}try{let e=await this.runCommand("dpm set-device-owner com.android.cts.egate/.a");(0,d.z)(()=>{this.log+="Device owner set (lg-classic): ".concat(e||"Command completed","\n")})}catch(e){(0,d.z)(()=>{this.log+="Device owner setup failed: ".concat(e.message,"\n")})}}else if("general"===e)try{let e=await this.runCommand("dpm set-device-owner ".concat(r,"/.a"));(0,d.z)(()=>{this.log+="Device owner set: ".concat(e||"Command completed","\n")})}catch(e){(0,d.z)(()=>{this.log+="Device owner setup failed: ".concat(e.message,"\n")})}else"external"===e&&(0,d.z)(()=>{this.log+="Skipping device owner setup for external accessibility variant.\n"});(0,d.z)(()=>{this.progress={filename:i.name,stage:n.Completed,value:1}})}catch(e){(0,d.z)(()=>{this.log+="Error during package setup: ".concat(e.message,"\n"),this.progress={filename:i.name,stage:n.Completed,value:1}})}let m=Date.now()-o,p=(i.size/(m/1e3)/1024/1024).toFixed(2);(0,d.z)(()=>{this.log+="\nInstall process completed in ".concat(m," ms at ").concat(p," MB/s\n"),this.installing=!1})},(0,d.ky)(this,{progress:d.LO.ref})}};t.default=(0,m.Pi)(()=>{let e=!!u.GLOBAL_STATE.adb,t=!e||y.installing;return(0,i.jsxs)(l.K,{...w.LE,tokens:{childrenGap:20},children:[(0,i.jsx)(h(),{children:(0,i.jsx)("title",{children:"eGate auto-installer - WADB"})}),(0,i.jsxs)(l.K,{horizontal:!0,tokens:{childrenGap:15},children:[(0,i.jsx)(o.K,{disabled:t,text:"General",onClick:()=>y.install("general")}),(0,i.jsx)(o.K,{disabled:t,text:"LG Classic",onClick:()=>y.install("lg-classic")}),(0,i.jsx)(o.K,{disabled:t,text:"External Accessibility",onClick:()=>y.install("external")})]}),y.progress&&(0,i.jsx)(r.Y,{styles:{root:{width:300,marginTop:20}},label:y.progress.filename,percentComplete:y.progress.value,description:n[y.progress.stage]}),y.log&&(0,i.jsx)("pre",{style:{marginTop:20,whiteSpace:"pre-wrap",fontFamily:"monospace"},children:y.log})]})})}},function(e){e.O(0,[774,888,179],function(){return e(e.s=3039)}),_N_E=e.O()}]);
//# sourceMappingURL=eGateinstall-5f12a1d565d3a4b5.js.map